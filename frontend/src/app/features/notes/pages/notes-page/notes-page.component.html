<div>
  <!-- <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Notes</h1> -->
  <div class="max-w-7xl mx-auto mt-3">
    <div class="relative search-bar">
      <!-- <lucide-icon [img]="SearchIcon"
        class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"></lucide-icon> -->
      <input type="text" placeholder="Search notes..." [value]="searchQuery()" (input)="onSearch($event)" class="w-full pl-2 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                 focus:ring-2 focus:ring-blue-500 focus:border-transparent
                 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white search-bar-input" />
    </div>
  </div>

  <div class="h-full flex flex-col mt-25">
    <!-- Notes Grid -->
    <div class="flex-1 overflow-y-auto px-6 py-6 bg-system-color">
      <div>
        <!-- Pinned Notes -->
        @if (pinnedNotes().length > 0) {
        <div class="mb-8">
          <h2 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">
            Pinned
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
            @for (note of pinnedNotes(); track note.id) {
            <app-note-card [note]="note" (clicked)="openEditNote($event)" (edit)="openEditNote($event)"
              (delete)="deleteNote($event)" (togglePin)="togglePin($event)" />
            }
          </div>
        </div>
        }

        <!-- Regular Notes -->
        @if (regularNotes().length > 0) {
        <div>
          <h2 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">
            Notes
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
            @for (note of regularNotes(); track note.id) {
            <app-note-card [note]="note" (clicked)="openEditNote($event)" (edit)="openEditNote($event)"
              (delete)="deleteNote($event)" (togglePin)="togglePin($event)" />
            }
          </div>
        </div>
        }

        <!-- Empty State -->
        @if (filteredNotes().length === 0) {
        <div class="flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400">
          <p class="text-lg">No notes yet</p>
          <p class="text-sm">Click the + button to create your first note</p>
        </div>
        }
      </div>
    </div>

    <!-- Floating Action Button -->
    <button (click)="openNewNote()" class="fixed bottom-18 right-8 w-14 h-14 add-note-btn text-white rounded-full 
           shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center">
      <lucide-icon [img]="PlusIcon" class="w-6 h-6"></lucide-icon>
    </button>

    <!-- Editor Modal -->
    @if (showEditor()) {
    <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">

        <!-- Editor Header -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
            {{ editingNote() ? 'Edit Note' : 'New Note' }}
          </h2>

          <div class="flex items-center gap-2">
            <!-- Preview Toggle -->
            <button (click)="togglePreview()" class="px-3 py-1.5 rounded-lg border border-gray-300 dark:border-gray-600
                     hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center gap-2">
              <lucide-icon [img]="isPreviewMode() ? EditIcon : EyeIcon" class="w-4 h-4"></lucide-icon>
              <span class="text-sm">{{ isPreviewMode() ? 'Edit' : 'Preview' }}</span>
            </button>

            <!-- Close Button -->
            <button (click)="closeEditor()"
              class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
              <lucide-icon [img]="CloseIcon" class="w-5 h-5"></lucide-icon>
            </button>
          </div>
        </div>

        <!-- Editor Body -->
        <div class="flex-1 overflow-hidden flex flex-col p-6">
          <!-- Title Input -->
          <input type="text" placeholder="Note title..." [(ngModel)]="editorTitle" class="text-2xl font-semibold border-none focus:outline-none mb-4
                   bg-transparent text-gray-900 dark:text-white" />

          <!-- Content Area -->
          <div class="flex-1 overflow-hidden">
            @if (isPreviewMode()) {
            <!-- Preview Mode -->
            <app-markdown-preview [content]="editorContent()" class="h-full" />
            } @else {
            <!-- Edit Mode -->
            <textarea [(ngModel)]="editorContent" placeholder="Write your note in markdown... 

**Bold** _Italic_ `code`
- List item
1. Numbered list
[Link](url)
```language
code block
```" class="w-full h-full resize-none border border-gray-300 dark:border-gray-600 rounded-lg p-4
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent
                       bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm"></textarea>
            }
          </div>
        </div>

        <!-- Editor Footer -->
        <div class="px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3">
          <button (click)="closeEditor()" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                   hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
            Cancel
          </button>
          <button (click)="saveNote()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg
                   transition-colors">
            {{ editingNote() ? 'Update' : 'Save' }}
          </button>
        </div>
      </div>
    </div>
    }
  </div>
  <!-- Add notes functionality will be implemented here -->
</div>