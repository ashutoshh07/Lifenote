<div class="habit-form-dialog">
  <!-- Header -->
  <div class="dialog-header">
    <h2 mat-dialog-title>
      <mat-icon>{{ isEditMode ? 'edit' : 'add_circle' }}</mat-icon>
      {{ isEditMode ? 'Edit Habit' : 'Create New Habit' }}
    </h2>
    <button 
      mat-icon-button 
      (click)="onCancel()"
      [disabled]="submitting">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Content -->
  <mat-dialog-content>
    <form [formGroup]="habitForm">
      
      <!-- Habit Name (Large Title) -->
      <mat-form-field class="title-field">
        <input 
          matInput 
          formControlName="name"
          placeholder="What's your new habit?"
          maxlength="200">
        <mat-error *ngIf="habitForm.get('name')?.hasError('required')">
          Name is required
        </mat-error>
      </mat-form-field>

      <!-- Description (Clean Area) -->
      <mat-form-field class="description-field">
        <textarea 
          matInput 
          formControlName="description"
          placeholder="Add a few details (optional)..."
          rows="2"
          maxlength="500"></textarea>
      </mat-form-field>

      <div class="form-section">
        <span class="section-label">Appearance</span>
        
        <!-- Icon Grid -->
        <div class="icon-grid mb-6">
          <button 
            *ngFor="let icon of availableIcons"
            type="button"
            class="icon-button"
            [class.selected]="habitForm.value.iconName === icon.name"
            (click)="selectIcon(icon.name)"
            [title]="icon.label">
            <mat-icon>{{ icon.name }}</mat-icon>
          </button>
        </div>

        <!-- Color Grid -->
        <div class="color-grid">
          <button 
            *ngFor="let color of availableColors"
            type="button"
            class="color-button"
            [style.background-color]="color.value"
            [class.selected]="habitForm.value.color === color.value"
            (click)="selectColor(color.value)"
            [title]="color.label">
            <mat-icon>check</mat-icon>
          </button>
        </div>
      </div>

      <div class="form-section">
        <span class="section-label">Schedule & Goal</span>
        
        <!-- Target Count -->
        <div class="flex items-center justify-between bg-muted p-4 rounded-xl mb-6">
          <div class="flex flex-col">
            <span class="font-bold">Daily Goal</span>
            <span class="text-xs text-muted-foreground">Times per day</span>
          </div>
          <div class="counter">
            <button 
              type="button"
              mat-icon-button
              (click)="decrementTarget()"
              [disabled]="habitForm.value.targetCount <= 1">
              <mat-icon>remove</mat-icon>
            </button>
            <span class="counter-value">{{ habitForm.value.targetCount }}</span>
            <button 
              type="button"
              mat-icon-button
              (click)="incrementTarget()"
              [disabled]="habitForm.value.targetCount >= 10">
              <mat-icon>add</mat-icon>
            </button>
          </div>
        </div>
      </div>

    </form>
  </mat-dialog-content>

  <mat-dialog-actions>
    <button 
      mat-button 
      (click)="onCancel()"
      [disabled]="submitting">
      Cancel
    </button>
    <button 
      mat-raised-button 
      color="primary"
      (click)="onSubmit()"
      [disabled]="submitting || habitForm.invalid">
      <mat-icon *ngIf="!submitting">{{ isEditMode ? 'save' : 'add' }}</mat-icon>
      <mat-icon *ngIf="submitting" class="spinner">sync</mat-icon>
      {{ submitting ? 'Saving...' : (isEditMode ? 'Save Changes' : 'Create Habit') }}
    </button>
  </mat-dialog-actions>
</div>
